---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - Talia Fabregas
  - Fatimah Yunusa
  - Aamishi Sundeep Avarsekar
thanks: "Code and data are available at: https://github.com/taliafabs/US-Election-Forecast-2024.git"
date: today
date-format: long
abstract: "The 2024 U.S. Presidential Election ..."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(janitor)
library(rstanarm)
library(readr)
library(ggplot2)
library(knitr)
library(arrow)
```

# Introduction

The 2024 U.S. Presidential Election will take place on Tuesday November 5 2024. Incumbent President Joseph R. Biden Jr. will seek a second term. Former President Donald J. Trump GOP nominee.

Delegates to secure the nomination, Nikki Haley has dropped out of GOPYou can and should cross-reference sections and sub-sections. We use @citeR and

The remainder of this paper is structured as follows. @sec-data discusses the survey and post-stratification data used.

Clear gap that needs to be filled ... what is the research gap and why is this important?

-   2024 US Presidential Election

-   how consequential this election is

-   what is on the ballot

-   women's rights

-   trump's project 2025 thing

If someone's done it before not on this data set not in this context

Previous groups have looked at ...

@citeR was usd

# Data {#sec-data}

```{r}
library(arrow)
library(dplyr)
survey_analysis_data <- arrow::read_parquet("/Users/talia/US-Election-Forecast/data/analysis_data/survey_analysis_data.parquet")
# poststrat_analysis_data <- read_parquet("/Users/talia/US-Election-Forecast/data/analysis_data/poststrat_analysis_data.parquet")
print(survey_analysis_data)

proportion_biden <- survey_analysis_data %>%
  filter(vote_biden == 1) %>%
  summarise(proportion = n() / nrow(survey_analysis_data))

proportion_biden_by_state <- survey_analysis_data %>%
  group_by(state) %>%
  summarise(proportion_biden = mean(vote_biden == 1, na.rm = TRUE))

proportion_by_state <- survey_analysis_data %>%
  group_by(state) %>%
  summarise(proportion = n() / nrow(survey_analysis_data))

proportion_biden_by_state
proportion_by_state

# only includes 7 observations from hawaii
# Hawaii is historically a Democratic stronghold
# only 4 samples from kansas
```

```{r}
#| label: fig-survey_presidential_preferences
#| fig-cap: The Distribution of Presidential Preferences, by gender and highest level of education
#| echo: false
survey_analysis_data |>
  ggplot(aes(x = education_level, fill = vote24)) +
  stat_count(position = "dodge") +
  facet_wrap(facets = vars(sex)) +
  theme_minimal() +
  labs(
    x = "Highest education",
    y = "Number of respondents",
    fill = "Preferred Presidential Candidate"
  ) +
  coord_flip() +
  scale_fill_brewer(palette = "Set1") +
  theme(legend.position = "bottom")
```

## Survey Data {#sec-survey}

Survey data is from @americaspoliticalpulse This section should talk about the survey data set

### Survey Data figures and tables go here

```{r}
#| label: fig-survey_presidential_preferences1
#| fig-cap: The Distribution of Presidential Preferences, by gender and race
#| echo: false

survey_analysis_data |>
  ggplot(aes(x = races, fill = vote24)) +
  stat_count(position = "dodge") +
  facet_wrap(facets = vars(sex)) +
  theme_minimal() +
  labs(
    x = "Race",
    y = "Number of respondents",
    fill = "Preferred Presidential Candidate"
  ) +
  coord_flip() +
  scale_fill_brewer(palette = "Set1") +
  theme(legend.position = "bottom")
```

```{r}
#| label: fig-electoral-map-survey
#| fig-cap: Electoral map based solely on the survey data
#| echo: false
library(ggplot2)
library(statebins)
survey_electoral_map <- survey_analysis_data %>% 
  group_by(state, vote_biden) %>% 
  summarise(n = n()) %>% 
  group_by(state) %>% 
  mutate(prop = n/sum(n)) %>% 
  filter(vote_biden == 1)

survey_electoral_map %>%
  mutate(statename = str_to_title(state)) %>%
  ggplot(aes(fill = prop, state = statename)) +
  geom_statebins() +
  scale_fill_gradient2(low = "#d12531", high = "#244999",
                       mid = "white", midpoint = mean(survey_electoral_map$prop)) +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank()) +
  labs(fill = "Proportion Voting \nfor Biden",
       title = "Map of the US States that plan to support Joe Biden or Donald Trump")

# note extremely small sample sizes from Hawaii, Kansas, and Wyoming
# note that survey sample size was only 1000
```

## Post Stratification Data {#sec-poststrat}

@citeIPUMS

```{r}
#| label: fig-temp1
#| fig-cap: abc
#| echo: false

```

Talk more about it.

```{r}
#| label: fig-temp2
#| fig-cap: temp
#| echo: false
#| warning: false
#| message: false

# analysis_data <- read_csv(here::here("data/analysis_data/analysis_data.csv"))
# 
# analysis_data |> 
#   ggplot(aes(x = width, y = length)) +
#   geom_point(alpha = 0.8) +
#   theme_minimal() +
#   labs(x = "Wing width (mm)",
#        y = "Wing length (mm)")
```

Talk way more about it.

# Model

logistic regression

binary

predicts support for trump or biden

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.

The logistic regression used to predict ... is as follows:

```{=tex}
\begin{align}
y_i &= \beta_0 + \beta_1 \times x_{sex} + \beta_2 \times x_{age\_bracket} + \beta_3 \times x_{races} + \beta_3 \times x_{education\_level} + \beta_4 \times x_{state} + \beta_5 
\times x_{urban} + \beta_5 \times x_{race\_black}
\end{align}
```
We run our model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.

We use the `predict()` function in R @citeR to apply our logistic regression model to the ACS Census data @citeIPUMS.

Model weaknesses: logistic regression output is binary so it does not include the options of not voting or voting for a third-party candidate.

### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.

# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

presidential_vote_model <-
  readRDS(file = here::here("models/presidential_vote_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of presidential vote based on ..."
#| warning: false

modelsummary::modelsummary(
  list(
    "Presidential Vote Model" = presidential_vote_model
  ),
  statistic = "mad",
  fmt = 2
)
```

# Discussion

## Popular Vote Projection {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this.

## Electoral College Projection

## Polarization and America's Urban-Rural Divide

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {.unnumbered}

# Additional data details

# Model details {#sec-model-details}

## Correlation Map

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows...

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

# pp_check(first_model) +
#   theme_classic() +
#   theme(legend.position = "bottom")
# 
# posterior_vs_prior(first_model) +
#   theme_minimal() +
#   scale_color_brewer(palette = "Set1") +
#   theme(legend.position = "bottom") +
#   coord_flip()
```

Model plot (still need to fix this)

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelplot1
#| tbl-cap: "Model Plot"
#| warning: false

# modelplot(presidential_vote_model, conf_level = 0.9) +
#   labs(x = "90 per cent credibility interval")

```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2
# 
# plot(first_model, "trace")
# 
# plot(first_model, "rhat")
```

\newpage

# References
