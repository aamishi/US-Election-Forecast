---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - Talia Fabregas
  - Fatimah Yunusa
  - Aamishi Sundeep Avarsekar
thanks: "Code and data are available at: https://github.com/taliafabs/US-Election-Forecast-2024.git"
date: today
date-format: long
abstract: "The 2024 U.S. Presidential Election ..."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(janitor)
library(rstanarm)
library(readr)
library(ggplot2)
library(knitr)
library(arrow)
```

# Introduction

The 2024 U.S. Presidential Election will take place on Tuesday November 5 2024. Incumbent President Joseph R. Biden Jr. will seek a second term. Former President Donald J. Trump GOP nominee.

Delegates to secure the nomination, Nikki Haley has dropped out of GOPYou can and should cross-reference sections and sub-sections. We use @citeR and

Packages used for data cleaning, model, visualizations, and tables: `tidyverse` @citetidyverse, `janitor` @citejanitor, `rstanarm`, `readr`, `ggplot2`, `knitr`, and `arrow`.

The remainder of this paper is structured as follows. @sec-data discusses the survey and post-stratification data used.

Clear gap that needs to be filled ... what is the research gap and why is this important?

-   2024 US Presidential Election

-   how consequential this election is

-   what is on the ballot

-   women's rights

-   trump's project 2025 thing

If someone's done it before not on this data set not in this context

Previous groups have looked at ...

@citeR was usd

# Data {#sec-data}

```{r}
#| include: false
#| warning: false
#| message: false

library(arrow)
library(dplyr)
survey_analysis_data <- arrow::read_parquet("/Users/talia/US-Election-Forecast/data/analysis_data/survey_analysis_data.parquet")
# poststrat_analysis_data <- read_parquet("/Users/talia/US-Election-Forecast/data/analysis_data/poststrat_analysis_data.parquet")
print(survey_analysis_data)

proportion_biden <- survey_analysis_data %>%
  filter(vote_biden == 1) %>%
  summarise(proportion = n() / nrow(survey_analysis_data))

proportion_biden_by_state <- survey_analysis_data %>%
  group_by(state) %>%
  summarise(proportion_biden = mean(vote_biden == 1, na.rm = TRUE))

proportion_by_state <- survey_analysis_data %>%
  group_by(state) %>%
  summarise(proportion = n() / nrow(survey_analysis_data))

proportion_biden_by_state
proportion_by_state

# only includes 7 observations from hawaii
# Hawaii is historically a Democratic stronghold
# only 4 samples from kansas
```

```{r}
#| echo: false
#| warning: false
#| label: fig-survey_presidential_preferences
#| fig-cap: The Distribution of Presidential Preferences, by gender and highest level of education
survey_analysis_data |>
  ggplot(aes(x = education_level, fill = vote24)) +
  stat_count(position = "dodge") +
  facet_wrap(facets = vars(sex)) +
  theme_minimal() +
  labs(
    x = "Highest education",
    y = "Number of respondents",
    fill = "Preferred Presidential Candidate"
  ) +
  coord_flip() +
  scale_fill_brewer(palette = "Set1") +
  theme(legend.position = "bottom")
```

```{r}

```

## Individual-Level Survey Data {#sec-survey}

Our survey data is from the America's Political Pulse Survey conducted by the Polarization Research Lab. The Polarization Research Lab is a research group founded by top political science research scholars at Dartmouth College, Stanford University, and the University of Pennsylvania, dedicated to applying scientific research methods to the study of democracy and political polarization @americaspoliticalpulse. The Polarization Research Lab studies political polarization across the United States by conducting the Political Pulse Survey each week and making the results available to anyone, in real time, via their website. The America's Political Pulse Survey interviews 1000 American adults each week and asks them questions that aim to track affective polarization, support for violations of democratic norms, and support for the use of political violence in America @americaspoliticalpulse. The Polarization Research Lab makes high-level results of their survey easily accessible and visible via their website's dashboard.

The specific survey data set used is the America's Political Pulse Survey Data Week 3 2024 January 12-19. It contains the responses of the 1000 American adults interviewed between January 12-19 2024. Demographic information about respondents, including sex, age, race, home state, employment status, marital status, ... is included. Participants were als asked who they voted for in the 2016 and 2020 U.S. presidential characteristics, what their party affiliation is, and what their political ideology is.

However, this data set has a few major limitations. It contains very few respondents from Hawaii, Wyoming, and Kansas. It contains zero respondents from Vermont.

The survey does not contain a question about preferred 2024 Presidential Candidate. In fact, it was conducted in January 2024, before Super Tuesday took place and Donald Trump had secured almost enough delegates to win the Republican nomination. At the time when this survey was conducted, former President Donald Trump, former South Carolina Governor Nikki Haley, and Florida Governor Ron DeSantis were all GOP Presidential primary candidates. Media personality Vivek Ramaswamy ended his primary campaign on January 15th, however this was in no way a clear indication that Trump had secured the nomination. As of March 11, 2024, former President Trump has secured 1078 out of the 1215 delegates needed to win the GOP nomination.

### Survey Data figures and tables go here

In order to gain a better understanding of our survey data, we conducted exploratory data analysis.

Within our survey data, the vote distribution between Trump and Biden varies by sex and race. As seen in @fig-survey_presidential_preferences1, Black females were more likely to vote for President Joe Biden (D-Delaware) than former President Donald Trump (R-Florida) in 2020, whereas white males were more likely to vote for former President Trump. This indicates that race might be a predictor of who an individual's preferred presidential candidate is.

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-survey_presidential_preferences1
#| fig-cap: The Distribution of Presidential Preferences, by gender and race

survey_analysis_data |>
  ggplot(aes(x = races, fill = vote24)) +
  stat_count(position = "dodge") +
  facet_wrap(facets = vars(sex)) +
  theme_minimal() +
  labs(
    x = "Race",
    y = "Number of respondents",
    fill = "Preferred Presidential Candidate"
  ) +
  coord_flip() +
  scale_fill_brewer(palette = "Set1") +
  theme(legend.position = "bottom")
```

```{r}
# write about America's urban-rural divide
#| echo: false
#| warning: false
#| label: fig-survey_urban_rural
#| fig-cap: The Distribution of Presidential Preferences of Respondents Living in Urban vs Rural Areas
survey_analysis_data |>
  ggplot(aes(x = urban, fill = vote24)) +
  stat_count(position = "dodge") +
  # facet_wrap(facets = vars(sex)) +
  theme_minimal() +
  labs(
    y = "Number of respondents",
    fill = "Preferred Presidential Candidate"
  ) +
  scale_fill_brewer(palette = "Set1") +
  theme(legend.position = "bottom")

# do a table of the proportion of respondents for trump vs biden in each state
# overall is like 51% biden
```

```{r}
#| echo: false
#| warning: false
#| label: tbl-survey_presidential_preferences_table
#| fig-cap: Who Voters Plan to Support (Survey Data)

num_respondents <- nrow(survey_analysis_data)
num_biden <- sum(survey_analysis_data$vote_biden)
num_trump <- num_respondents - num_biden

```

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-electoral-map-survey
#| fig-cap: Electoral map based solely on the survey data
library(ggplot2)
library(statebins)
survey_electoral_map <- survey_analysis_data %>% 
  group_by(state, vote_biden) %>% 
  summarise(n = n()) %>% 
  group_by(state) %>% 
  mutate(prop = n/sum(n)) %>% 
  filter(vote_biden == 1)

survey_electoral_map %>%
  mutate(statename = str_to_title(state)) %>%
  ggplot(aes(fill = prop, state = statename)) +
  geom_statebins() +
  scale_fill_gradient2(low = "#d12531", high = "#244999",
                       mid = "white", midpoint = mean(survey_electoral_map$prop)) +
  theme_classic() +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank()) +
  labs(fill = "Proportion Voting \nfor Biden",
       title = "Map of the US States that plan to support Joe Biden or Donald Trump")

# note extremely small sample sizes from Hawaii, Kansas, and Wyoming
# note that survey sample size was only 1000
```

@fig-electoral-map-survey illustrates the proportion of voters in each U.S. state who plan to support President Biden in the 2024 Presidential Election. We can see that there is strong support for President Biden in Washington, Oregon, New York, New Jersey, Maryland, Massachusetts, and Connecticut. We also see that Oklahoma, Idaho, and Utah heavily favor former President Trump. These results are expected and there were similar margins in the 2020 election. These states have also been Dem and GOP strongholds since 1992 (or whatever year). However, this electoral map also highlights some of the limitations fo teh survey data. Wyoming and Kansas are very blue in the electoral map based solely on the survey data, however that is very far from recent election results in those states. In fact, Wyoming was the most Pro-Trump state in both the 2016 and 2020 presidential elections, with Trump receiving 2016% and 2020% of the vote in each of those elections, respectively. The survey data set includes very few examples from small states.

## Post Stratification Data {#sec-poststrat}

The post-stratification data used is comes from the American Community Survey (ACS) 2022 provided by IPUMS ( @citeIPUMS ).

```{r}
#| label: fig-temp1
#| fig-cap: abc
#| echo: false

```

Talk more about it.

```{r}
#| label: fig-temp2
#| fig-cap: temp
#| echo: false
#| warning: false
#| message: false

# analysis_data <- read_csv(here::here("data/analysis_data/analysis_data.csv"))
# 
# analysis_data |> 
#   ggplot(aes(x = width, y = length)) +
#   geom_point(alpha = 0.8) +
#   theme_minimal() +
#   labs(x = "Wing width (mm)",
#        y = "Wing length (mm)")
```

Talk way more about it.

# Model

logistic regression

binary

predicts support for trump or biden

<!-- # Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details]. -->

```{r survey_model, echo=F, message=F, fig.cap="Results of Regression Model"}
library(rstanarm)
library(arrow)
library(dplyr)

# poststrat_analy <- arrow::read_parquet("/Users/talia/US-Election-Forecast/data/analysis_data/poststrat_analysis_data.parquet")
# 
# poststrat_data_cells <-
#   poststrat_analysis_data |>
#   count(state, sex, age_group, education_level)
# 
# poststrat_data_cells <-
#   poststrat_data_cells |>
#   mutate(prop = n / sum(n),
#          .by = stateicp)
# 
# poststrat_data_cells
```

## Model set-up

Define $y_i$ whether an individual's preferred 2024 presidential candidate is Joe Biden (1) or Donald Trump (0). The logistic regression model used to predict support for Biden using sex, age, race, highest level of education, state, and whether the individual lives in an urban or rural area is as follows:

```{=tex}
\begin{align}
Pr(vote\_biden_i =1) = logit^{-1}( \beta_0 + \beta_1 \times x_{sexi} + \beta_2 \times x_{age\_bracketi} +  \beta_3 \times x_{racesi} + \\
\beta_3 \times x_{education\_leveli} + \beta_4 \times x_{statei} + \beta_5 
\times x_{urbani} + \beta_5 \times x_{race\_blacki})
\end{align}
```
We run our model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.

We use the `predict()` function in R @citeR to apply our logistic regression model to the ACS Census data @citeIPUMS.

Model weaknesses: logistic regression output is binary so it does not include the options of not voting or voting for a third-party candidate.

### Model justification

We expect to see increased support for President Biden amongst Black college-educated women in urban areas.

We can use maths by including latex between dollar signs, for instance $\theta$.

# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

presidential_vote_model <-
  readRDS(file = here::here("models/presidential_vote_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of presidential vote based on ..."
#| warning: false

modelsummary::modelsummary(
  list(
    "Presidential Vote Model" = presidential_vote_model
  ),
  statistic = "mad",
  fmt = 2
)
```

# Discussion

## Popular Vote Projection {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this.

## Electoral College Projection

## Polarization and America's Urban-Rural Divide

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {.unnumbered}

# Additional data details

# Model details {#sec-model-details}

## Correlation Map

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows...

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

# pp_check(first_model) +
#   theme_classic() +
#   theme(legend.position = "bottom")
# 
# posterior_vs_prior(first_model) +
#   theme_minimal() +
#   scale_color_brewer(palette = "Set1") +
#   theme(legend.position = "bottom") +
#   coord_flip()
```

Model plot (still need to fix this)

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelplot1
#| tbl-cap: "Model Plot"
#| warning: false

# modelplot(presidential_vote_model, conf_level = 0.9) +
#   labs(x = "90 per cent credibility interval")

```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2
# 
# plot(first_model, "trace")
# 
# plot(first_model, "rhat")
```

\newpage

# References
